let dot(x: vector*3, y: vector*3): real =
	(x*y).sum in

let magnitude(x: vector*3): real =
	sqrt(dot(x, x)) in

// up is a unit vector pointing away from the planet's core.
let up = xyz / magnitude(xyz) in

// xyz normalised to the lunar surface (i.e. at altitude 0).
let xyzn = up * nominal_radius in

let scale = 5e3 in

let c = dot(surface_normal, sun_direction) in
let cplus = if (c>0) then c else 0 in
let emission = (sun_colour + ambient_colour)*cplus in
return
